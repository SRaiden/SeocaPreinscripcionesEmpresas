@model Sindicato_Viedma.Models.ViewModels.CrearInteres


@{
    ViewData["Title"] = "Boletas / Interes";
}

<!-- Banner -->
@Html.Partial("~/Views/Shared/MisViews/Banner.cshtml")

@{
    if (ViewBag.Session != false) // Si esta logueado que se muestre la barra menu
    {
        @Html.Partial("~/Views/Shared/BarraNavegacion.cshtml")
    }

}

<!-- ----------------- F  O  R  M  U  L  A  R  I  O   S ----------------- -->
<div class="w3-content" style="max-width:1564px">

    @using (Html.BeginForm("Intereses", "Boletas", FormMethod.Post, new { @class = "w3-content", autocomplete = "off", style = "max-width:1564px" }))
    {

        <!-- -------------------- Numero Acta / Cuenta / Cuota -------------------- -->
    <div class="w3-row" hidden>
        <div class="w3-half w3-container w3-text-white">
            <div class="w3-padding bg-zul ">Cuit</div>
            <input class="w3-input w3-ligth-grey" type="text" placeholder="Cuit" value="@ViewBag.cuit" id="terCUIT" readonly>
        </div>
        <div class="w3-quarter w3-container w3-text-white" hidden>
            <input type="text" value="@ViewBag.fechaActual" id="fechaActual" />
        </div>
    </div>

        <div class="w3-row">
            <div class="w3-third w3-container w3-text-white">
                <div class="w3-padding bg-zul">Periodo</div>
                <div class="w3-half">
                    <select class="w3-select" name="PeriodoMes" onchange="comboMes()" id="PeriodoMes">
                        <option value="" disabled selected>Mes</option>
                        <option value="01">Enero</option>
                        <option value="02">Febrero</option>
                        <option value="03">Marzo</option>
                        <option value="04">Abril</option>
                        <option value="05">Mayo</option>
                        <option value="06">Junio</option>
                        <option value="07">Julio</option>
                        <option value="08">Agosto</option>
                        <option value="09">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                    </select>
                </div>
                <div class="w3-half">
                    <select class="w3-select" name="PeriodoAnio" onchange="comboMes()" id="PeriodoAnio">
                        <option value="" disabled selected>Año</option>
                        <option value="2015">2015</option>
                        <option value="2016">2016</option>
                        <option value="2017">2017</option>
                        <option value="2018">2018</option>
                        <option value="2019">2019</option>
                        <option value="2020">2020</option>
                        <option value="2021">2021</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                    </select>
                </div>
            </div>
            <div class="w3-third w3-container w3-text-white">
                <div class="w3-padding bg-zul ">Fecha Pago</div>
                @Html.TextBoxFor(model => model.FechaPago, new { @class = "w3-input w3-ligth-grey", type = "date", value = "", onblur = "InteresPago()" })
            </div>
            <div class="w3-third w3-container w3-text-white">
                <div class="w3-padding bg-zul ">Vencimiento</div>
                @Html.TextBoxFor(model => model.Vencimiento, new { @class = "w3-input w3-ligth-grey", type = "date", value = "", @readonly = "readonly" })
            </div>

        </div>
        <br>

        <!-- -------------------- Total -------------------- -->
        <div class="w3-row">
            <div class="w3-third w3-container w3-text-white">
                <div class="w3-padding bg-zul">Motivo</div>
                <select asp-for="Motivo" class="w3-select" name="IdMotivo" id="IdMotivo">
                    @{
                        if (ViewData["Motivo"] != null)
                        {
                            IEnumerable<dynamic> motivo = (IEnumerable<dynamic>)ViewData["Motivo"];
                            <option value="0">< Seleccione un Motivo ></option>
                            foreach (dynamic mov in motivo)
                            {
                                string NombreMotivo = mov.Motivo;
                                int IdMotivo = mov.IdMotivo;
                                <option value="@mov.IdMotivo">@NombreMotivo.ToUpper()</option>
                            }
                        }
                    }
                </select>
            </div>
            <div class="w3-third w3-container w3-text-white">
                <div class="w3-padding bg-zul">Comentario</div>
                @Html.TextBoxFor(model => model.Comentario, new { @class = "w3-input w3-border", placeholder = "Comentario", id = "Comentario" });
            </div>
            <div class="w3-third w3-container w3-text-white ">
                <div class="w3-padding bg-zul">Importe Original</div>
                @Html.TextBoxFor(model => model.ImporteOriginal, new { @class = "w3-input w3-ligth-grey w3-right-align", onchange = "changeCamposInteres()", name = "ImporteOriginal" })
            </div>
        </div>


        <div class="w3-row">
            <div class="w3-third w3-container w3-text-white">
            </div>
            <div class="w3-third w3-container w3-text-white">
            </div>
            <div class="w3-third w3-container w3-text-white">
                <button class="w3-right w3-margin-top w3-button w3-card bg-zul w3-text-white w3-hover-blue w3-hover-border-cyan" style="margin: 0 0 0 200px;" type="submit" onclick="return validarCamposActas();">
                    Crear Pago Interes
                </button>
            </div>
        </div>

    }

</div>

<br />

<script>
    $("#PeriodoMes").val("@ViewBag.mesPeriodo");
    $("#PeriodoAnio").val("@ViewBag.anioPeriodo");

    periodo();

    function periodo() {

        var e = document.getElementById("PeriodoMes");
        var mes = e.options[e.selectedIndex].value;
        var a = document.getElementById("PeriodoAnio");
        var anio = a.options[a.selectedIndex].value;


        var CUIT = document.getElementById("terCUIT").value;
        var termCUIT = CUIT.charAt(CUIT.length - 1);

        var accion = 0;

        if (mes != "" && anio != "") {
            @*var list = JSON.parse('@Html.Raw(Json.Serialize(ViewBag.periodoFechaVen))');*@
            var list = @Html.Raw(Json.Encode(ViewBag.periodoFechaVen));
            for (var i = 0; i < list.length; i++) {
                if (termCUIT == list[i].Ter_CUIT) {
                    var diaVen = list[i].Dia_Vencimiento;
                    if (mes == "12") {
                        mes = "01";
                        anio = parseInt(anio);
                        anio = (anio + 1).toString();
                        var fecha = anio + "-" + mes + "-" + diaVen;
                    } else {
                        mes = parseInt(mes);
                        if (mes <= 8) {
                            mes = (mes + 1).toString();
                            mes = "0" + mes;
                        } else {
                            mes = (mes + 1).toString();
                        }

                        var fecha = anio + "-" + mes + "-" + diaVen;
                    }
                    document.getElementById("FechaPago").value = fecha;
                    document.getElementById("Vencimiento").value = fecha;
                    accion = 1;
                }
            }

            if (accion == 0) {
                document.getElementById("FechaPago").value = 'dd/mm/aaaa';
                document.getElementById("Vencimiento").value = 'dd/mm/aaaa';
            }
        }
    }

    
</script>

@if (!string.IsNullOrEmpty(ViewBag.message))
{
    <script type="text/javascript">
        alert("@ViewBag.message");
    </script>
}

@section scripts{
    <script src="~/js/Interes.js"></script>
}